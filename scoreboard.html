<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scoreboard</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quantico:ital,wght@0,400;0,700;1,400;1,700&display=swap');

        :root {
            /* Default Values (can be overridden by URL params) */
            --home-primary: rgb(0, 0, 0);
            --home-secondary: rgb(30, 113, 58);
            --home-text: white;
            
            --guest-primary: red;
            --guest-secondary: white;
            --guest-text: black;
        }

        body {
            font-size: 100%;
            margin: 0;
            padding: 0;
            background-color: transparent; /* Allow iframe transparency */
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        .scoreboard {
            font-family: 'Quantico', sans-serif;
            font-weight: 900;
            /* Scale based on viewport but maintain readability */
            font-size: min(2.5vw, 2.5vh); 
            
            /* Allow width to grow to fit names, but ensure symmetry */
            width: fit-content;
            min-width: 40em;
            max-width: 95vw; /* Prevent screen overflow */
            
            position: relative;
            display: flex;
            flex-direction: column;
        }
        
        @media (min-width: 1600px) {
             .scoreboard { font-size: 40px; }
        }

        .header {
            display: flex;
            width: 100%;
            background-color: rgb(0, 0, 0);
            color: rgb(255, 255, 255);
            flex-direction: row;
            justify-content: center;
            font-weight: 500;
            font-size: 75%;
        }

        .header > .period {
            padding: 0.15em 0.5em;
            padding-top: 0;
            left: 0;
            position: absolute;
        }

        .header > .time {
            align-self: center;
            color: transparent; /* Keep transparent as per original design */
        }

        /* Use Grid to ensure both sides are exactly equal width and fit content */
        .teams {
            display: grid;
            grid-template-columns: 1fr 1fr;
            width: 100%;
            font-size: 175%;
        }

        .home {
            flex-direction: row;
            display: flex;
            align-items: center;
            justify-content: space-between;
            /* Dynamic Background: Bottom 10% Secondary, Rest Primary */
            background: linear-gradient(0deg, var(--home-secondary) 10%, var(--home-primary) 10%);
            color: var(--home-text);
            /* Ensure it fills the grid cell */
            width: 100%;
            box-sizing: border-box;
            border-right: 1px solid rgba(0,0,0,0.1); 
        }

        .away {
            display: flex;
            align-items: center;
            flex-direction: row;
            justify-content: space-between;
            /* Dynamic Background: Bottom 10% Secondary, Rest Primary */
            background: linear-gradient(0deg, var(--guest-secondary) 10%, var(--guest-primary) 10%);
            color: var(--guest-text);
            /* Ensure it fills the grid cell */
            width: 100%;
            box-sizing: border-box;
        }

        .teamscore {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-grow: 1;
            /* Allow text to take distinct space */
            white-space: nowrap;
            overflow: hidden;
            padding: 0 0.5em;
        }

        .logo {
            display: flex;
            flex-shrink: 0; /* Prevent logos from crushing */
        }

        .logo > img {
            height: 1.25em;
            width: auto;
            max-width: 3em; 
            object-fit: contain;
        }

        .home > .logo {
            padding-right: 0.2em;
            padding-left: 0.2em;
        }

        .away > .logo {
            padding-left: 0.2em;
            padding-right: 0.2em;
        }

        .score {
            padding: 0 0.5em;
        }

        .name {
            overflow: hidden;
            text-overflow: ellipsis; 
        }
    </style>
</head>
<body>

<div class="scoreboard">
    <div class="header">
        <div class="period" id="period">1. Drittel</div>
        <div class="time">00:00</div>
    </div>
    <div class="teams">
        <div class="home">
            <div class="logo">
                <img class="logo_home" id="img_home" src="" alt="" onerror="this.style.display='none'">
            </div>
            <div class="teamscore">
                <div class="name" id="name_home">HOME</div>
                <div class="score" id="score_home">0</div>
            </div>
        </div>
        <div class="away">
            <div class="teamscore">
                <div class="score" id="score_away">0</div>
                <div class="name" id="name_away">AWAY</div>
            </div>
            <div class="logo">
                <img class="logo_away" id="img_away" src="" alt="" onerror="this.style.display='none'">
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    const urlParams = new URLSearchParams(window.location.search);
    const gameId = urlParams.get('id') || '42941';

    // Apply URL overrides
    const setProp = (key, customProp) => {
        if(urlParams.get(key)) document.documentElement.style.setProperty(customProp, decodeURIComponent(urlParams.get(key)));
    };
    
    // Config Home
    setProp('hp', '--home-primary');
    setProp('hs', '--home-secondary');
    setProp('ht', '--home-text');
    
    // Config Guest
    setProp('gp', '--guest-primary');
    setProp('gs', '--guest-secondary');
    setProp('gt', '--guest-text');

    const setTextIfChanged = (id, text) => {
        const el = document.getElementById(id);
        if (el && el.innerText !== text) {
            el.innerText = text;
        }
    };

    // Apply Name overrides immediately
    if(urlParams.get('hn')) setTextIfChanged('name_home', decodeURIComponent(urlParams.get('hn')));
    if(urlParams.get('gn')) setTextIfChanged('name_away', decodeURIComponent(urlParams.get('gn')));

    const API_URL = `https://saisonmanager.de/api/v2/games/${gameId}.json`;
    const FETCH_INTERVAL = 10000;

    function fixLogoUrl(url) {
        if (!url) return '';
        if (url.startsWith('/')) {
            return 'https://saisonmanager.de' + url;
        }
        return url;
    }

    async function fetchGameData() {
        try {
            const response = await fetch(API_URL);
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            const data = await response.json();
            const res = data.result;

            // Update Scores
            const hGoals = (res?.home_goals ?? 0).toString();
            const gGoals = (res?.guest_goals ?? 0).toString();
            setTextIfChanged('score_home', hGoals);
            setTextIfChanged('score_away', gGoals);
            
            // Update Period
            const period = (data.current_period_title?.title ?? "1. Drittel");
            setTextIfChanged('period', period);
            
            // Update Names (if not overridden)
            if(!urlParams.get('hn') && data.home_team_name) setTextIfChanged('name_home', data.home_team_name);
            if(!urlParams.get('gn') && data.guest_team_name) setTextIfChanged('name_away', data.guest_team_name);

            // Update Logos
            const updateLogo = (imgId, rawUrl) => {
                const fullUrl = fixLogoUrl(rawUrl);
                const img = document.getElementById(imgId);
                if (fullUrl && img.dataset.src !== fullUrl) {
                    img.src = fullUrl;
                    img.dataset.src = fullUrl; 
                    img.style.display = 'block';
                } else if (!fullUrl) {
                    // img.style.display = 'none'; // Optional: hide if no logo
                }
            };
            
            updateLogo('img_home', data.home_team_logo);
            updateLogo('img_away', data.guest_team_logo);

        } catch (error) {
            console.error('Error fetching scoreboard data:', error);
        }
    }

    // Initial Fetch
    fetchGameData();
    // Poll
    setInterval(fetchGameData, FETCH_INTERVAL);

</script>
</body>
</html>